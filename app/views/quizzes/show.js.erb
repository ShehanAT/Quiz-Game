function goToHomePage(){
    window.location.href = "/";
}
function goToQuizzes(){
    window.location.href = "/quizzes";
}
function replayQuiz(){
    location.reload();
}
$(document).ready(function(){
$("#quiz_gameplay_section").show().children().show();
$("#quiz_info_section").hide().children().hide();
function shuffle(a) {
    var j, x, i;
    for (i = a.length - 1; i > 0; i--) {
        j = Math.floor(Math.random() * (i + 1));
        x = a[i];
        a[i] = a[j];
        a[j] = x;
    }
    return a;
}


var quizIdParms = window.location.pathname
$.ajax({
    url: quizIdParms,
    dataType: "json",
    method: "GET",
    data: {},
    success: function(data){
        var quizId = data.quiz.id;
        var questionsLeft = data.questions.length;
        var randomArr = shuffle(data.questions);
        var currentQuestion;
        var score = 0;
        function changeScene(e){
            if(currentQuestion = randomArr.pop()){
                setupQuiz(data, currentQuestion)
            }else{
                $.ajax({
                    url: "/save_score",
                    method: "GET",
                    data: {
                        score: score,
                        quiz_id: quizId
                    },
                    dataType: "json",
                    success: function(data){
                        console.log(data);
                        $("#save_score_status").text(data.status);
                    }
                });
                $("#quiz_gameplay_section").hide().children().hide();
                $("#quiz_end_game_section").show().children().show();
                $("#end_score_message").text("Your Score: " + score); 
            }
        }
        
        function checkAnswer(e){
            console.log(questionsLeft);
            if(questionsLeft){
                questionsLeft -= 1;
                if(e.target.value == currentQuestion.answer_id){
                    updateScore();
                } 
            }
        }

        function updateScore(){
            score += 10;
            $(".save_score_message").text("Your Score: " + score);
        }

        

        function setupQuiz(data, nextQuestion){
            console.log("passing");
            $("#current_question").text(nextQuestion.question);
            var currentChoices = []
            for(var i = 0; i < data.answers.length; i++){
                if(data.answers[i].question_id === nextQuestion.id){
                    currentChoices.push(data.answers[i]);
                }
            }
            for(var i = 1; i = currentChoices.length; i++){
                var answer = currentChoices.pop()
                $("#answer"+i).text(answer.answer);
                $("#answer"+i).val(i);
            }
        }

        (function setFirstQuestion(){
            currentQuestion = randomArr.pop();
            setupQuiz(data, currentQuestion);
        }());

        (function setupInterface(){
            $("button").on("click ", function(e){
                checkAnswer(e);
                changeScene(e);
                
            });
            $(".save_score_message").text("Your Score: " + score);
        }());
    }   
})
});